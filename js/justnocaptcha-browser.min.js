class JustNoCaptcha{static challengeSalt;static encoder;static createChallenge(e=50,t=4){if(!JustNoCaptcha.challengeSalt)throw new Error("JustNoCaptcha.challengeSalt required, should be a random value not exposed to solver clients");let a;if("undefined"!=typeof window||"undefined"!=typeof self){let r=(self||window).crypto;void 0!==r&&(a=t=>{var e;let a="";for(e of r.getRandomValues(new Uint8Array(t)))a+=e.toString(16).padStart(2,"0");return a})}let r=t+"";for(let t=0;t<e;t++)r+=a(16);return r+JustNoCaptcha.hash(r+JustNoCaptcha.challengeSalt)}static verifySolution(t,e){var a=JustNoCaptcha.parseChallengeData(t,!0);if(!e||e.length!==a.solutionLengthRequired)throw new Error("Invalid solution");for(let t=0;t<a.numberPuzzles;t++){var r=e.substring(t*a.lengthPerSolution,t*a.lengthPerSolution+a.lengthPerSolution);if(!(JustNoCaptcha.hashInt(a.puzzlesString.substring(32*t,32*t+32)+r)<=a.threshold))return!1}return!0}static async solveChallenge(t,r=null){var o=JustNoCaptcha.parseChallengeData(t,!1);let n=o.numberPuzzles;if("undefined"!=typeof window&&"function"==typeof Worker){var l=JustNoCaptcha.toString()+";\n",s=[];let a=0;for(let e=0;e<n;e++){var i=l,u=o.puzzlesString.substring(32*e,32*e+32),u=(i+="(async()=>{self.postMessage(JustNoCaptcha.solverWorker("+JSON.stringify(u)+", "+JSON.stringify(o.difficulty)+"))})()",new Blob([i],{type:"text/javascript"}));let t=new Worker(URL.createObjectURL(u));s.push(new Promise(e=>{t.onmessage=t=>{"string"==typeof t.data&&(a++,r&&r(1/n*a),e(t.data))}}))}return(await Promise.all(s)).join("")}{let e="";for(let t=0;t<n;t++)e+=JustNoCaptcha.solverWorker(o.puzzlesString.substring(32*t,32*t+32),o.difficulty),r&&r(1/n*t);return e}}static hash(e){e=JustNoCaptcha.toUint8Array(e);let a=2166136261,r=2341284503,o=3386659096,n=2073922445;var l=16777619;for(let t=0;t<e.byteLength;t++){var s=e[t];a=(a^s)>>>0,a=Math.imul(a,l)>>>0,r=(r^s<<1&255)>>>0,r=Math.imul(r,l)>>>0,o=(o^s<<2&255)>>>0,o=Math.imul(o,l)>>>0,n=(n^s<<3&255)>>>0,n=Math.imul(n,l)>>>0}return JustNoCaptcha.fmix(a)+JustNoCaptcha.fmix(r)+JustNoCaptcha.fmix(o)+JustNoCaptcha.fmix(n)}static hashInt(e){e=JustNoCaptcha.toUint8Array(e);let a=2166136261;for(let t=0;t<e.byteLength;t++){var r=e[t];a=(a^r)>>>0,a=Math.imul(a,16777619)>>>0}return JustNoCaptcha.fmix(a,!1)}static solverWorker(t,e=4){var a=Math.pow(10,10-e),r=Math.pow(10,e+2);let o=Math.pow(10,e+1);for(;o<=r;){if(JustNoCaptcha.hashInt(t+o)<=a)return o.toString();o++}return""}static fmix(t,e=!0){var a=65535&(t=((t>>>=0)^t>>>16)>>>0),a=(t=51819*a+(51819*(t>>>16&65535)+34283*a<<16>>>0)>>>0&4294967295,65535&(t^=t>>>13));return t=((t=44597*a+(44597*(t>>>16&65535)+49842*a<<16>>>0)>>>0&4294967295)^t>>>16)>>>0,e?t.toString(16).padStart(8,"0"):t>>>0}static toUint8Array(t){if(!JustNoCaptcha.encoder){let e=new TextEncoder;JustNoCaptcha.encoder=t=>"string"==typeof t||"number"==typeof t?e.encode(t+""):t}return JustNoCaptcha.encoder(t)}static parseChallengeData(t,e){var a="string"==typeof t?t.length:0;if(a<33||(a-1)%32)throw new Error("Invalid challenge data");if(e&&!JustNoCaptcha.challengeSalt)throw new Error("JustNoCaptcha.challengeSalt required, should be a random value not exposed to solver clients");var r=parseInt(t.substring(0,1));if(r<1||7<r)throw new Error("Invalid difficulty, need to be between 1 and 7");a=t.substring(1,a-32);if(e&&JustNoCaptcha.hash(t.substring(0,t.length-32)+JustNoCaptcha.challengeSalt)!==t.substring(t.length-32))throw new Error("Invalid challenge hash");e=a.length/32,t=r+2;return{difficulty:r,puzzlesString:a,numberPuzzles:e,lengthPerSolution:t,solutionLengthRequired:e*t,threshold:Math.pow(10,10-r)}}}"undefined"!=typeof module&&module.exports&&(module.exports=JustNoCaptcha);